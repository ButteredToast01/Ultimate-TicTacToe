<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ultimate Tic Tac Toe</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f0f0f0;
  }
  h1 { margin: 10px; }
  #turn { font-size: 20px; margin: 10px; }
  #board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    width: 660px;
    margin: 20px auto;
  }
  .small-board {
    display: grid;
    grid-template-columns: repeat(3, 1fr); 
    border: 3px solid black;
    gap: 2px;
    width: 200px;
    height: 200px;
    position: relative;
  }
  .cell {
    border: 1px solid #888;
    background: white;
    font-size: 36px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    user-select: none;
  }
  .won-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(200, 200, 200, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 80px;
    font-weight: bold;
    pointer-events: none;
  }

.active-board {
  outline: 4px solid orange; /* highlights the active small board */
}
  
</style>
</head>
<body>
<h1>Ultimate Tic Tac Toe</h1>
<div id="turn">Turn: X</div>
<div id="board"></div>
<div id="message"></div>

<script>
const boardElement = document.getElementById('board');
const turnElement = document.getElementById('turn');
const messageElement = document.getElementById('message');

let currentPlayer = 'X';
let boards = []; // 9 small boards
let boardStatus = Array(9).fill(null); // null, 'X', 'O', or 'draw'
let nextBoard = null; // determines which small board is active

// Create 9 small boards
for (let i = 0; i < 9; i++) {
  const small = document.createElement('div');
  small.classList.add('small-board');
  small.dataset.index = i;
  boards[i] = Array(9).fill(null);

  for (let j = 0; j < 9; j++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.dataset.index = j;
    cell.dataset.board = i;
    cell.addEventListener('click', cellClick);
    small.appendChild(cell);
  }
  boardElement.appendChild(small);
}

function cellClick(e) {
  const boardIndex = parseInt(e.target.dataset.board);
  const cellIndex = parseInt(e.target.dataset.index);

  if (boardStatus[boardIndex] || boards[boardIndex][cellIndex] || (nextBoard !== null && boardIndex !== nextBoard)) {
    return; // invalid move
  }

  boards[boardIndex][cellIndex] = currentPlayer;
  e.target.textContent = currentPlayer;

  // Check if small board is won
  const winner = checkWinner(boards[boardIndex]);
  if (winner) {
    boardStatus[boardIndex] = winner;
    const overlay = document.createElement('div');
    overlay.classList.add('won-overlay');
    overlay.textContent = winner;
    e.target.parentElement.appendChild(overlay);
  } else if (boards[boardIndex].every(c => c)) {
    boardStatus[boardIndex] = 'draw';
  }

  // Check if big board is won
  const bigWinner = checkWinner(boardStatus.map(s => s==='draw'?null:s));
  if (bigWinner) {
    messageElement.textContent = `ðŸŽ‰ Player ${bigWinner} wins the game! ðŸŽ‰`;
    turnElement.textContent = '';
    return;
  } else if (boardStatus.every(s => s)) {
    messageElement.textContent = 'Draw!';
    turnElement.textContent = '';
    return;
  }

  // Determine next board
  if (boardStatus[cellIndex]) {
    nextBoard = null; // free move
  } else {
    nextBoard = cellIndex;
  }
  
  // Switch players
  currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
  turnElement.textContent = `Turn: ${currentPlayer}`;

  //Highlight active board
  updateActiveBoard();
}

updateActiveBoard();

function updateActiveBoard() {
  const smallBoards = document.querySelectorAll('.small-board');
  smallBoards.forEach((board, i) => {
    board.classList.remove('active-board'); // remove previous highlight
    if (nextBoard === null && !boardStatus[i]) {
      // If free move, highlight all boards that are not won
      board.classList.add('active-board');
    } else if (nextBoard === i && !boardStatus[i]) {
      // Highlight only the next board
      board.classList.add('active-board');
    }
  });
}

// Function to check winner in a 3x3 board
function checkWinner(cells) {
  const lines = [
    [0,1,2],[3,4,5],[6,7,8], // rows
    [0,3,6],[1,4,7],[2,5,8], // columns
    [0,4,8],[2,4,6]           // diagonals
  ];
  for (const [a,b,c] of lines) {
    if (cells[a] && cells[a] === cells[b] && cells[a] === cells[c]) return cells[a];
  }
  return null;
}
</script>
</body>
</html>
